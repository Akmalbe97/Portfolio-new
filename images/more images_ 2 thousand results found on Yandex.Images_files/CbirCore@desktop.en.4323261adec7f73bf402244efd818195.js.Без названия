!function(t){function e(e){for(var r,a,c=e[0],u=e[1],s=e[2],f=0,h=[];f<c.length;f++)a=c[f],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&h.push(i[a][0]),i[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(t[r]=u[r]);for(l&&l(e);h.length;)h.shift()();return o.push.apply(o,s||[]),n()}function n(){for(var t,e=0;e<o.length;e++){for(var n=o[e],r=!0,c=1;c<n.length;c++){var u=n[c];0!==i[u]&&(r=!1)}r&&(o.splice(e--,1),t=a(a.s=n[0]))}return t}var r={},i={189:0},o=[];function a(e){if(r[e])return r[e].exports;var n=r[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=r,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)a.d(n,r,function(e){return t[e]}.bind(null,r));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="https://yastatic.net/s3/fiji-static/_/";var c=window.webpackJsonp=window.webpackJsonp||[],u=c.push.bind(c);c.push=e,c=c.slice();for(var s=0;s<c.length;s++)e(c[s]);var l=u;o.push([1389,"963a41"]),n()}({0:function(t,e){t.exports=React},10:function(t,e,n){"use strict";n.d(e,"a",function(){return a}),n.d(e,"b",function(){return c});var r=n(23),i=n(9),o=function(t){var e=t.dtype,n=void 0===e?"iweb":e,i=t.path,o=t.vars,a={dtype:n,path:i,pid:t.pid,cid:t.cid},c=o&&Object(r.e)(o,!0);return c&&(a.vars=c),a},a=function(t,e){var n,r=void 0===e?{}:e,a=r.reqid,c=r.dtype,u=r.vars,s=r.pid,l=r.cid,f=r.href;if(!i.a)throw Error("Нельзя вызывать отправку счетчика на сервере");null===(n=window.c)||void 0===n||n.hit(o({path:t,reqid:a,dtype:c,vars:u,pid:s,cid:l}),f?{href:f}:void 0)},c=function(t,e){var n,r=void 0===e?{}:e,a=r.reqid,c=r.dtype,u=r.vars,s=r.pid,l=r.cid,f=r.href;if(!i.a)throw Error("Нельзя вызывать отправку счетчика на сервере");null===(n=window.c)||void 0===n||n.hitDelayed(o({path:t,reqid:a,dtype:c,vars:u,pid:s,cid:l}),f?{href:f}:void 0)}},108:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var r=n(0),i=n(33),o=n(45),a=function(){return Object(r.useCallback)(function(t,e,n){return void 0===e&&(e=document.title),void 0===n&&(n=location.href),Object(o.a)().pushJob(function(){return history.pushState(Object(i.d)(t),e,n)},!1)},[])}},109:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(33),i=function(){function t(){this.listeners=[],this.jobs=[],this.onPopState=this.onPopState.bind(this)}return t.prototype.resolveCurrentJob=function(t,e){this.listeners.forEach(function(e){return e(t)}),this.currentJob&&this.currentJob.async===e?(this.currentJob.resolve(t),this.currentJob=void 0):this.reset()},t.prototype.executeCurrentJob=function(){var t=this;this.currentJob&&(this.currentJob.execute(),this.currentJob.async||(this.nextTickJobTimeoutId=window.setTimeout(function(){t.resolveCurrentJob(Object(r.c)(),!1),t.next()})))},t.prototype.onPopState=function(t){this.resolveCurrentJob(t.state||{},!0),this.next()},t.prototype.next=function(){this.currentJob||(this.currentJob=this.jobs.shift(),this.executeCurrentJob())},t.prototype.reset=function(){this.jobs=[],this.currentJob=void 0,window.clearTimeout(this.nextTickJobTimeoutId)},t.prototype.startListening=function(t){0===this.listeners.length&&window.addEventListener("popstate",this.onPopState),this.listeners.push(t)},t.prototype.stopListening=function(t){this.listeners=this.listeners.filter(function(e){return e!==t}),0===this.listeners.length&&window.removeEventListener("popstate",this.onPopState)},t.prototype.pushJob=function(t,e){var n=this;return new Promise(function(r){n.jobs.push({execute:t,resolve:r,async:e}),n.next()})},t}()},1389:function(t,e,n){n(85),t.exports=n(1694)},14:function(t,e){t.exports=ReactDOM},1694:function(t,e,n){"use strict";n.r(e),n.d(e,"App",function(){return a});var r=n(27),i=n(940).a,o=n(719),a=Object(r.b)(o.b)(i)},23:function(t,e,n){"use strict";n.d(e,"e",function(){return o}),n.d(e,"a",function(){return a}),n.d(e,"b",function(){return c}),n.d(e,"c",function(){return u}),n.d(e,"d",function(){return s});var r=function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},i=function(t,e){var n="function"===typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a};function o(t,e){if("string"===typeof t||!t)return t||"";if(Array.isArray(t))return t.join(",");var n=e?"-":"";return Object.keys(t).filter(function(e){return"undefined"!==typeof t[e]&&""!==t[e]}).map(function(e){return""+n+e+"="+t[e]}).join(",")}function a(t){if(t)return t.logNode}function c(t,e,n,i){void 0===e&&(e={}),void 0===n&&(n={}),void 0===i&&(i={href:""});var a=u(t);if(!a||!a.__oldCounter__)return a;var c=a.__oldCounter__,l=o(r(r({},s(c.vars||{})),s(e)));return r(r({},a),{__oldCounter__:r(r(r({},c),{vars:l}),n),node:i})}function u(t){if(t&&Array.isArray(t.counter)){var e=i(t.counter,2),n=e[0],r=e[1];return{__oldCounter__:{path:n||"",vars:r||""}}}return t||{}}function s(t){return void 0===t&&(t={}),"object"===typeof t?t:t.split(",").reduce(function(t,e){var n=e.split("=");return t[n[0]]=n[1],t},{})}},242:function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"b",function(){return a});var r=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function c(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(a,c)}u((r=r.apply(t,e||[])).next())})},i=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},o=function(t){return new Promise(function(e,n){var r=new Image;r.onload=function(){return e(r)},r.onerror=function(t){return n(t)},r.src=t})},a=function(t){return r(void 0,void 0,Promise,function(){var e,n,r,a;return i(this,function(i){switch(i.label){case 0:e=window.URL||window.webkitURL,n=e.createObjectURL(t),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,o(n)];case 2:return r=i.sent(),e.revokeObjectURL(n),[2,r];case 3:throw a=i.sent(),e.revokeObjectURL(n),a;case 4:return[2]}})})}},33:function(t,e,n){"use strict";n.d(e,"c",function(){return o}),n.d(e,"d",function(){return a}),n.d(e,"b",function(){return c}),n.d(e,"a",function(){return u});var r=n(9),i=Object.prototype.hasOwnProperty,o=function(){return Object.assign({},r.a?history.state:null)},a=function(t){return Object.assign({},o(),t)},c=function(t){return void 0===t&&(t={}),Object.assign({},"function"===typeof t?t():t)},u=function(t,e){var n=Object.assign({},t);for(var r in e)i.call(e,r)&&!i.call(n,r)&&(n[r]=e[r]);return n}},41:function(t,e,n){"use strict";var r,i="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),o=64,a={},c=0,u=0;function s(t){var e="";do{e=i[t%o]+e,t=Math.floor(t/o)}while(t>0);return e}function l(){var t=s(+new Date);return t!==r?(c=0,r=t):t+"."+s(c++)}for(;u<o;u++)a[i[u]]=u;l.encode=s,l.decode=function(t){var e=0;for(u=0;u<t.length;u++)e=e*o+a[t.charAt(u)];return e},t.exports=l},45:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n(109),i=function(){return window.Ya=window.Ya||{},window.Ya.HistoryQueue||(window.Ya.HistoryQueue=new r.a),window.Ya.HistoryQueue}},55:function(t,e,n){"use strict"},56:function(t,e,n){"use strict";"function"===typeof Element&&(Element.prototype.matches=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector)},719:function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"a",function(){return o});var r=n(4),i="CbirCore",o=Object(r.cn)("CbirCore")},790:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(t){return t.nodeType!==Node.ELEMENT_NODE?null:"IMG"===t.tagName?t:t.querySelector("img")}},85:function(t,e,n){n.r(e);var r=n(6);Object(r.setI18nLang)("en")},940:function(t,e,n){"use strict";n.d(e,"a",function(){return W});var r=n(0),i=n.n(r),o=n(8),a=n(10),c=n(84),u=n(251);n(9).a&&!HTMLCanvasElement.prototype.toBlob&&Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,n){void 0===e&&(e="image/png");var r=this.toDataURL(e,n).split(",")[1];setTimeout(function(){for(var n=atob(r),i=n.length,o=new Uint8Array(i),a=0;a<i;a++)o[a]=n.charCodeAt(a);t(new Blob([o],{type:e}))})}});var s=n(242),l=1,f=3,h=6,d=8,p=9,b=function(t){return 65280===(65280&t)},v=function(){function t(t){this.offset=0,this.littleEndian=!1,this.view=new DataView(t)}return t.prototype.skip=function(t){this.offset+=t},t.prototype.nextUint16=function(){var t=this.view.getUint16(this.offset,this.littleEndian);return this.skip(2),t},t.prototype.nextUint32=function(){var t=this.view.getUint32(this.offset,this.littleEndian);return this.skip(4),t},t.prototype.setLittleEndian=function(t){this.littleEndian=t},t.prototype.isFinished=function(){return this.offset>=this.view.byteLength},t}(),y=function(t){return function(){return"from-image"===getComputedStyle(document.body).imageOrientation}()?Promise.resolve(l):new Promise(function(e,n){var r=new FileReader;r.onload=function(){if(!r.result)return e(p);var t,n,i=new v(r.result);if(65496!==i.nextUint16())return e(p);for(;!i.isFinished()&&(t=i.nextUint16(),b(t)&&65498!==t&&65497!==t);)if(65505===t){i.skip(2),i.skip(6),i.setLittleEndian(18761===i.nextUint16()),i.skip(2),i.skip(i.nextUint32()-8),n=i.nextUint16();for(var o=0;o<n;o++){if(274===i.nextUint16())return i.skip(6),e(i.nextUint16());i.skip(10)}}else i.setLittleEndian(!1),i.skip(i.nextUint16()-2);return e(p)},r.onerror=n,r.readAsArrayBuffer(t)})},w=function(t,e){var n=document.createElement("canvas");return n.width=t,n.height=e,n},g=function(t,e){var n="function"===typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},m=function(t,e){var n=g(function(t,e){var n=0,r=0,i="none";return e===d?(n=t.height,r=t.width,i="left"):e===h?(n=t.height,r=t.width,i="right"):e===f?(n=t.width,r=t.height,i="flip"):(n=t.width,r=t.height),[{width:n,height:r},i]}(t,e),2),r=n[0],i=n[1],o=function(t){var e=t.width/t.height,n=0,r=0,i={width:0,height:0};return t.width*t.height>5e6?t.width>t.height?(n=Math.sqrt(5e6*e),i={width:Math.floor(n),height:Math.floor(5e6/n)}):(r=Math.sqrt(5e6/e),i={width:Math.floor(5e6/r),height:Math.floor(r)}):i=t,i.width>4096&&(i.width=4096,i.height=Math.round(i.width/e)),i.height>4096&&(i.height=4096,i.width=Math.round(e*i.height)),i}(r),a=w(o.width,o.height),c=a.getContext("2d");if(!c)throw new Error("Cannot get a canvas context");return"left"===i?(c.setTransform(0,-1,1,0,0,o.height),c.drawImage(t,0,0,o.height,o.width)):"right"===i?(c.setTransform(0,1,-1,0,o.width,0),c.drawImage(t,0,0,o.height,o.width)):"flip"===i?(c.setTransform(-1,0,0,-1,o.width,o.height),c.drawImage(t,0,0,o.width,o.height)):(c.setTransform(1,0,0,1,0,0),c.drawImage(t,0,0,o.width,o.height)),a},j=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function c(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(a,c)}u((r=r.apply(t,e||[])).next())})},O=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},x=function(t,e){var n="function"===typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(t){i={error:t}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a},k=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function c(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(a,c)}u((r=r.apply(t,e||[])).next())})},E=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},S=function(t,e,n){return t.width>e&&t.height>n},P=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function c(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(a,c)}u((r=r.apply(t,e||[])).next())})},C=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},T=function(t,e,n,r,i){return void 0===r&&(r=t.type),void 0===i&&(i=1),P(void 0,void 0,Promise,function(){return C(this,function(o){switch(o.label){case 0:return[4,function(t){return j(void 0,void 0,Promise,function(){var e,n,r;return O(this,function(i){switch(i.label){case 0:return[4,Promise.all([Object(s.b)(t),y(t)])];case 1:return e=x.apply(void 0,[i.sent(),2]),n=e[0],r=e[1],[2,m(n,r)]}})})}(t)];case 1:return[4,function(t,e,n){return k(void 0,void 0,Promise,function(){var r,i,o,a,c;return E(this,function(u){switch(u.label){case 0:return r=t.width/t.height,n<e?n=Math.round(e/r):e=Math.round(n*r),S(t,e,n)?(i=Math.ceil(Math.log(t.width/e)/Math.LN2),o=e*Math.pow(2,i-1),a=n*Math.pow(2,i-1),c=function(r,u){var s=w(o,a),l=s.getContext("2d");return null===l?u(new Error("Cannot get a canvas context")):(l.drawImage(t,0,0,o,a),t.width=1,t.height=1,t=s,i-=1,o=Math.round(o/2),a=Math.round(a/2),i<=0||!S(t,e,n)?r(t):void requestAnimationFrame(function(){return c(r,u)}))},[4,new Promise(c)]):[2,t];case 1:return[2,u.sent()]}})})}(o.sent(),e,n)];case 2:return[4,function(t,e,n){return void 0===n&&(n=1),new Promise(function(r,i){try{t.toBlob(function(t){return t?r(t):i("Resulting Blob is empty")},e,n)}catch(t){i(t)}})}(o.sent(),r,i)];case 3:return[2,o.sent()]}})})},M=n(28),U=function(t){return t.replace(/\/preview$/,"/orig")},_=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function c(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(a,c)}u((r=r.apply(t,e||[])).next())})},I=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},L=function(t){return _(void 0,void 0,Promise,function(){var e,n;return I(this,function(r){switch(r.label){case 0:return e=function(){return Object(M.appendQueryString)("/images-apphost/image-download",{cbird:37,images_avatars_size:"preview",images_avatars_namespace:"images-cbir"})}(),[4,fetch(e,{method:"POST",body:t})];case 1:return[4,r.sent().json()];case 2:return n=r.sent(),[2,{originalImageUrl:U(n.url),cbirId:n.image_shard+"/"+n.image_id}]}})})},D=n(108),J=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function c(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(a,c)}u((r=r.apply(t,e||[])).next())})},A=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},B=function(){var t=Object(D.a)();return Object(r.useCallback)(function(e){var n=e.originalImageUrl,r=e.cbirId;return J(void 0,void 0,void 0,function(){var e;return A(this,function(i){switch(i.label){case 0:return e=function(t){var e=t.originalImageUrl,n=t.cbirId,r={rpt:"imageview",from:void 0};return e&&(r.url=e),n&&(r.cbir_id=n),BEM.blocks["i-global"].param("isYandexApp")&&(r.service="cbir.yandex"),"0"===BEM.blocks.uri.getParamValue("native")&&(r.native="0"),BEM.blocks.uri.buildRelativeUrl(BEM.blocks["i-global"].param("router").search,BEM.blocks["i-url-controller"].mergePassedUrlParams(r))}({originalImageUrl:n,cbirId:r}),[4,t({cbirPageType:"search-by-image",cbirCropRect:void 0,cbirCropId:void 0},void 0,e)];case 1:return i.sent(),Object(o.a)().emit("cbir:load-page",{pageType:"search-by-image",url:e,withHistoryReplace:!0}),[2]}})})},[t])},R=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function c(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(a,c)}u((r=r.apply(t,e||[])).next())})},z=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},F=function(t){return/^https?:\/\//.test(t)?t:0===t.indexOf("//")?location.protocol+t:location.protocol+"//"+t},q=function(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function c(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):function(t){return t instanceof n?t:new n(function(e){e(t)})}(t.value).then(a,c)}u((r=r.apply(t,e||[])).next())})},G=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},H=n(790),Y=n(835),N=n(719),Q=Object(r.forwardRef)(function(t,e){var n=t.onSelect,o=Object(Y.a)(e),a=Object(r.useCallback)(function(){var t;if(o.current){var e=null===(t=o.current.files)||void 0===t?void 0:t[0];e&&n(e),o.current.value=""}},[o,n]);return i.a.createElement("input",{ref:o,className:Object(N.a)("FileInput"),type:"file",accept:"image/*",onChange:a,hidden:!0})}),W=function(t){var e=t.downscaleWidth,n=t.downscaleHeight,l=t.downscaleQuality,f=t.isYandexBroNativeCameraDialog,h=void 0!==f&&f,d=t.isYandexAppAndroid,p=void 0!==d&&d,b=t.isYandexAppIos,v=void 0!==b&&b,y=t.counterPaths,w=Object(r.useRef)(null),g=Object(r.useCallback)(function(t){"file"===t.searchType?Object(a.a)(y.searchByFileStart,{vars:{size:t.file.size,type:t.file.type}}):Object(a.a)(y.searchByUrlStart,{vars:{url:t.url}})},[y]);Object(c.a)("cbir:search-by-image:start",g);var m=Object(r.useCallback)(function(t){"file"===t.searchType?Object(a.a)(y.searchByFileSuccess,{vars:{size:t.file.size,type:t.file.type,time:t.time}}):Object(a.a)(y.searchByUrlSuccess,{vars:{url:t.url,time:t.time}})},[y]);Object(c.a)("cbir:search-by-image:success",m);var j=Object(r.useCallback)(function(t){"file"===t.searchType?Object(a.a)(y.searchByFileError,{vars:{size:t.file.size,type:t.file.type,time:t.time}}):Object(a.a)(y.searchByUrlError,{vars:{url:t.url,time:t.time}})},[y]);Object(c.a)("cbir:search-by-image:error",j);var O=Object(r.useCallback)(function(){var t;Object(a.a)(y.fileDialogOpen),h||p?location.assign("native://image_search"):v?location.assign("wireframe://?intent=openImageSearchScreen"):null===(t=w.current)||void 0===t||t.click()},[h,p,v,y]);Object(c.a)("cbir:open-file-dialog",O);var x=function(t){var e=t.downscaleWidth,n=t.downscaleHeight,i=t.downscaleQuality,a=B();return Object(r.useCallback)(function(t){return R(void 0,void 0,void 0,function(){var r,c,u,s,l,f;return z(this,function(h){switch(h.label){case 0:r=Date.now(),h.label=1;case 1:return h.trys.push([1,5,,6]),Object(o.a)().emit("cbir:search-by-image:start",{searchType:"file",file:t}),[4,T(t,e,n,"image/jpeg",i)];case 2:return c=h.sent(),[4,L(c)];case 3:return u=h.sent(),s=u.originalImageUrl,l=u.cbirId,[4,a({originalImageUrl:s,cbirId:l})];case 4:return h.sent(),Object(o.a)().emit("cbir:search-by-image:success",{searchType:"file",file:t,downscaledFile:c,originalImageUrl:s,cbirId:l,time:Date.now()-r}),[3,6];case 5:return f=h.sent(),Object(o.a)().emit("cbir:search-by-image:error",{searchType:"file",error:f,file:t,time:Date.now()-r}),[3,6];case 6:return[2]}})})},[e,n,i,a])}({downscaleWidth:e,downscaleHeight:n,downscaleQuality:l});Object(c.a)("cbir:search-by-file",x);var k=function(){var t=B();return Object(r.useCallback)(function(e){return q(void 0,void 0,void 0,function(){var n,r,i;return G(this,function(a){switch(a.label){case 0:n=F(e),r=Date.now(),a.label=1;case 1:return a.trys.push([1,4,,5]),Object(o.a)().emit("cbir:search-by-image:start",{searchType:"url",url:n}),[4,Object(s.a)(n)];case 2:return a.sent(),[4,t({originalImageUrl:n})];case 3:return a.sent(),Object(o.a)().emit("cbir:search-by-image:success",{searchType:"url",url:n,time:Date.now()-r}),[3,5];case 4:return i=a.sent(),Object(o.a)().emit("cbir:search-by-image:error",{searchType:"url",error:i,url:n,time:Date.now()-r}),[3,5];case 5:return[2]}})})},[t])}();Object(c.a)("cbir:search-by-url",k),function(t){var e=Object(r.useCallback)(function(e){var n=e.clipboardData||window.clipboardData;if(n){var r=function(t){if(t.items)for(var e=0;e<t.items.length;e+=1){var n=t.items[e];if("file"===n.kind)return n.getAsFile()}return t.files.length>0?t.files[0]:null}(n);r&&(e.preventDefault(),t(r))}},[t]);Object(u.a)("paste",e)}(Object(r.useCallback)(function(t){Object(a.a)(y.clipboardPaste,{vars:{size:t.size,type:t.type}}),x(t)},[y,x])),function(t,e){var n=Object(r.useRef)(!1);Object(r.useEffect)(function(){var r=function(){n.current||(n.current=!0,t())},i=function(){n.current&&(n.current=!1,e())},o=function(t){var e=t.dataTransfer;if(t.target&&e){var n=Object(H.a)(t.target);if(n){n!==t.target&&"function"===typeof e.setDragImage&&e.setDragImage(n,0,0);var i=n.getAttribute("src");i&&function(t,e){try{t.setData("text/uri-list",e),t.setData("text/plain",e)}catch(n){t.setData("URL",e),t.setData("Text",e)}}(e,F(i))}}requestAnimationFrame(r)};return document.addEventListener("dragover",r),document.addEventListener("dragstart",o),document.addEventListener("dragend",i),document.addEventListener("mousemove",i),window.addEventListener("focus",i),function(){document.removeEventListener("dragover",r),document.removeEventListener("dragstart",o),document.removeEventListener("dragend",i),document.removeEventListener("mousemove",i),window.removeEventListener("focus",i)}},[])}(Object(r.useCallback)(function(){Object(a.a)(y.dragStart),Object(o.a)().emit("cbir:drag-start")},[y]),Object(r.useCallback)(function(){Object(a.a)(y.dragEnd),Object(o.a)().emit("cbir:drag-end")},[y]));var E=Object(r.useCallback)(function(t){Object(a.a)(y.fileDialogSelect,{vars:{size:t.size,type:t.type}}),x(t)},[y,x]);return i.a.createElement(Q,{ref:w,onSelect:E})}}});